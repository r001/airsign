#!/usr/bin/env bash
#
tx=`termux-clipboard-get`
echo $tx
txkeys=`echo $tx|jshon -k|sed -e "s/\\[//g"|sed -e "s/\\]//g"|sed -e "s/\"//g"|sed -e "s/,/ /g"|sed -e "s/'//g"`
txkeys=($txkeys)
signjson=''
echo "Please wait 10 sec ..."
for row in "${txkeys[@]}" ; do 
	[[ $row == "condition" ]] && [[ `echo $tx | jshon -e "condition" -u` -eq "null"  ]] && continue
	[[ $row == "gasPrice" ]] && ro=gas-price && signjson=$signjson" --$ro `echo $tx | jshon -e $row -u`"&& continue
	[[ $row == "gas" ]] && ro=gas-limit && signjson=$signjson" --$ro `echo $tx | jshon -e $row -u`" && continue
	signjson=$signjson" --$row `echo $tx | jshon -e $row -u`"
done	
signjson="ethsign tx $signjson --chain-id 1"
raw=$($signjson)
echo $raw
linecount=${1:-150}
qr_count=0;
for $txl in `echo $raw|sed -r "s/(.{$linecount})/\\1 /g"`; do
	qr_count=$(( $qr_count + 1 ))
	echo "$qr_count. QR code to transmit"
	qr "$qr_count-$txl"
	read -n 1 -s
done
